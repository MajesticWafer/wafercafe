<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta Tags -->
  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height">
  
  <!-- Manifest and Icons -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="preload" href="audio-worklet.js" as="script">
  <link href="dark.css" rel="stylesheet">

  <title>DS Player</title>

  <!-- Internal CSS -->
  <style>
    body {
      background-color: black;
      color: white;
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      font-family: 'Myriad Set Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      overflow-x: hidden;
      user-select: none;
      cursor: inherit;
    }

    select, .vk, .vk-touched {
      color: #fff;
      background-color: #161f27;
      border: 2px solid #ffffff;
      border-radius: 6px;
      font-family: inherit;
      font-size: inherit;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.25);
    }

    .container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 20px;
    }

    .vk {
      position: absolute;
      z-index: 1;
      display: inline-block;
      text-align: center;
      vertical-align: middle;
      backdrop-filter: blur(1px);
    }

    #msg-layer, #vk-layer, #menu, #player {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #menu {
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(2.5px);
      overflow: hidden scroll;
    }

    a, a:visited {
      color: white;
    }

    .link {
      text-decoration: none;
      font-weight: italic;
    }
  </style>
</head>

<body>
  <div id="welcome" class="menu">
    <button class="button" style="float: right; margin: 5px 20px 0 0; height: 50px;" onclick="uiSwitchTo('menu')">⚙ Settings...</button>
    <h1 style="margin: 25px 0 0 20px;">DS Player</h1>
    <div id="loading" style="margin-left: 20px;">Loading...</div>
    <div id="loadrom" hidden>
      <input id="rom" type="file" hidden>
      <button id="btn-choose-file" style="width: calc(100% - 2em); margin: 1em;">Choose File (or drag/drop)...</button>
    </div>
    <hr>
    <div id="pro" style="background-color: #333"></div>
    <div id="ios-hint" hidden style="text-align: center;">⬇ Add this page to your <b>Home Screen</b> to save your game progress. ⬇</div>
    <div id="mac-warning" hidden>
      WARNING:<br>
      You're using macOS.<br>
      Your save data will be LOST after 7 days of inactivity in Safari.<br>
      Consider using a different browser, like <a href="https://www.google.com/chrome/">Chrome</a>.
    </div>
  </div>

  <div id="vk-layer" hidden>
    <div class="vk-rectangle vk" data-k="menu">Menu</div>
    <div class="vk-trig vk" data-k="l">L</div>
    <div class="vk-trig vk" data-k="r">R</div>
    <div class="vk-round vk" data-k="a">A</div>
    <div class="vk-round vk" data-k="b">B</div>
    <div class="vk-round vk" data-k="x">X</div>
    <div class="vk-round vk" data-k="y">Y</div>
    <div class="vk-square vk" data-k="select">-</div>
    <div class="vk-square vk" data-k="start">+</div>
    <div class="vk-round vk" data-k="stick">Stick</div>
    <div class="vk-rectangle vk" data-k="mic">Mic</div>
  </div>

  <div id="fps" style="position: absolute; bottom: 7px; right: 7px;"></div>

  <div id="msg-layer" hidden>
    <p id="msg-text"></p>
  </div>

  <div id="menu" hidden>
    <button id="back-menu" style="margin: 5px;" onclick="uiMenuBack()">❮ Back</button>
    <button style="margin: 5px;" onclick="runFunctions()">Enter Fullscreen</button>
    <hr>
    <label for="canvas-fullscreen">Fullscreen Selection:</label>
    <select id="canvas-fullscreen" class="select">
      <option value="top">Top Canvas</option>
      <option value="bottom">Bottom Canvas</option>
    </select>
    <hr>
    <label><input type="checkbox" id="cfg-opt"> Experimental optimization</label><br>
    <label><input type="checkbox" id="power-save"> Power-save</label><br>
    <label><input type="checkbox" id="vk-enabled"> Virtual keyboard</label><br>
    <label for="screen-layout">Screen Layout:</label>
    <select id="screen-layout" class="select">
      <option value="tb">T:B (Top:Bottom)</option>
      <option value="lr">L:R (Left:Right)</option>
      <option value="lbr">LB:R (LeftBig:Right)</option>
    </select>
    <hr>
    <div style="position: fixed; bottom: 0; left: 0; padding: 10px;">
      <a href="../gba" style="font-size: 12px;">GBA Player</a>
    </div>
    <div style="position: fixed; bottom: 0; right: 0; padding: 10px;">
      <span style="font-size: 12px;">Version 0.1 | </span><a href="#" style="font-size: 12px;" onclick="whatsNew()">What's New</a>
    </div>
    <div id="menu-savegame" hidden>
      <label>Save Data:</label>
      <button onclick="uiSaveBackup()">↓ Export</button>
      <button onclick="$id('restore-file').click()">↑ Import</button>
      <input type="file" id="restore-file" onchange="uiSaveRestore()" hidden>
      <hr>
    </div>
    <a id="a-gamepad">Gamepad Disconnected</a>
  </div>

  <div id="player" hidden>
    <canvas id="top" width="256" height="192"></canvas>
    <canvas id="bottom" width="256" height="192"></canvas>
  </div>

  <!-- Local Scripts -->
  <script src="localforage.js"></script>
  <script src="pako.min.js"></script>
  <script src="app.js"></script>
  <script src="sw-loader.js"></script>

  <!-- JavaScript Functions -->
  <script>
    function runFunctions() {
      var canvas = document.getElementById("canvas-fullscreen").value;
      uiMenuBack();
      openFullscreen(canvas);
    }

    function openFullscreen(canvasId) {
      var elem = document.getElementById(canvasId);
      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    }
  </script>
</body>
</html>
