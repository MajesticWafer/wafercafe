<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack Clone - Three.js</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: white;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let stack = [];
        let currentBlock;
        let speed = 0.05;
        let direction = 1;
        let score = 0;
        let gameRunning = true;

        // Initialize the scene
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(4, 4, 6);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5).normalize();
            scene.add(light);

            // Create the base block
            addBlock(0, 0, 3, 3, true);
            addMovingBlock();

            window.addEventListener('click', placeBlock);
            animate();
        }

        // Function to create a block
        function addBlock(x, y, width, depth, isStatic) {
            const geometry = new THREE.BoxGeometry(width, 0.5, depth);
            const material = new THREE.MeshStandardMaterial({ color: new THREE.Color(Math.random(), Math.random(), Math.random()) });
            const block = new THREE.Mesh(geometry, material);
            block.position.set(x, y, 0);
            scene.add(block);

            if (!isStatic) {
                currentBlock = block;
            } else {
                stack.push(block);
            }
        }

        // Function to handle the movement of the block
        function addMovingBlock() {
            const lastBlock = stack[stack.length - 1];
            const y = stack.length * 0.5;
            addBlock(-10, y, lastBlock.geometry.parameters.width, lastBlock.geometry.parameters.depth, false);
        }

        // Place block and split if necessary
        function placeBlock() {
            if (!gameRunning) return;

            const lastBlock = stack[stack.length - 1];
            const overlap = currentBlock.position.x - lastBlock.position.x;

            if (Math.abs(overlap) < currentBlock.geometry.parameters.width) {
                const remainingSize = currentBlock.geometry.parameters.width - Math.abs(overlap);
                const newWidth = Math.max(remainingSize, 0.2);

                currentBlock.scale.x = newWidth / currentBlock.geometry.parameters.width;
                currentBlock.position.x -= overlap / 2;
                stack.push(currentBlock);

                score++;
                document.getElementById('score').textContent = `Score: ${score}`;

                // Add a new moving block
                addMovingBlock();
            } else {
                // Game Over
                gameRunning = false;
                alert("Game Over! Your score: " + score);
            }
        }

        // Function to animate the scene
        function animate() {
            if (gameRunning) {
                currentBlock.position.x += direction * speed;
                if (currentBlock.position.x > 10 || currentBlock.position.x < -10) {
                    direction *= -1;
                }
            }

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        window.onload = init;
    </script>
</body>
</html>
