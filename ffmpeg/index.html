<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        input, select, button {
            margin: 10px;
        }
        #downloadLink {
            display: none;
            margin-top: 20px;
        }
    </style>
    <!-- Include VideoConverter.js -->
    <script src="https://bgrins.github.io/videoconverter.js/videoconverter.js"></script>
</head>
<body>
    <h1>Media Converter</h1>

    <input type="file" id="inputFile" accept="video/*,audio/*">

    <br>

    <label for="inputFormat">Input Format:</label>
    <select id="inputFormat">
        <option value="mp4">MP4</option>
        <option value="mov">MOV</option>
        <option value="mp3">MP3</option>
        <option value="m4a">M4A</option>
        <option value="wav">WAV</option>
    </select>

    <button id="switchBtn">Switch</button>

    <label for="outputFormat">Output Format:</label>
    <select id="outputFormat">
        <option value="mp3">MP3</option>
        <option value="m4a">M4A</option>
        <option value="wav">WAV</option>
        <option value="mp4">MP4</option>
        <option value="mov">MOV</option>
    </select>

    <br>

    <button id="convertBtn">Convert</button>
    <p id="status"></p>
    
    <a id="downloadLink" download>Download Converted File</a>

    <script>
        let convertingVideoToAudio = true;

        document.getElementById("switchBtn").addEventListener("click", () => {
            convertingVideoToAudio = !convertingVideoToAudio;
            updateFormatOptions();
        });

        function updateFormatOptions() {
            const inputFormat = document.getElementById("inputFormat");
            const outputFormat = document.getElementById("outputFormat");

            if (convertingVideoToAudio) {
                inputFormat.innerHTML = `
                    <option value="mp4">MP4</option>
                    <option value="mov">MOV</option>
                    <option value="mkv">MKV</option>
                    <option value="avi">AVI</option>
                `;
                outputFormat.innerHTML = `
                    <option value="mp3">MP3</option>
                    <option value="m4a">M4A</option>
                    <option value="wav">WAV</option>
                `;
            } else {
                inputFormat.innerHTML = `
                    <option value="mp3">MP3</option>
                    <option value="m4a">M4A</option>
                    <option value="wav">WAV</option>
                `;
                outputFormat.innerHTML = `
                    <option value="mp4">MP4</option>
                    <option value="mov">MOV</option>
                    <option value="avi">AVI</option>
                `;
            }
        }

        document.getElementById("convertBtn").addEventListener("click", async () => {
            const inputFile = document.getElementById("inputFile").files[0];
            if (!inputFile) {
                alert("Please select a file.");
                return;
            }

            const inputExt = document.getElementById("inputFormat").value;
            const outputExt = document.getElementById("outputFormat").value;
            const outputName = `output.${outputExt}`;

            document.getElementById("status").textContent = "Converting...";

            try {
                const reader = new FileReader();
                reader.onload = async function(event) {
                    const result = await convertVideo(event.target.result, outputExt);
                    const blob = new Blob([result], { type: `video/${outputExt}` });
                    const url = URL.createObjectURL(blob);
                    const downloadLink = document.getElementById("downloadLink");
                    downloadLink.href = url;
                    downloadLink.download = outputName;
                    downloadLink.style.display = "block";
                    downloadLink.textContent = "Download " + outputName;
                    document.getElementById("status").textContent = "Conversion complete!";
                };
                reader.readAsArrayBuffer(inputFile);
            } catch (error) {
                document.getElementById("status").textContent = "Conversion failed: " + error.message;
            }
        });

        async function convertVideo(data, format) {
            const result = await VideoConverter.convert({
                type: 'arrayBuffer',
                data: data,
                format: format
            });
            return result.data;
        }

        updateFormatOptions();
    </script>
</body>
</html>
